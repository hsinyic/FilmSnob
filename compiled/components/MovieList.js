import Movies from './Movies.js';
import Search from './Search.js';
import Add from './Add.js';
import searchMovieDB from '../searchMovieDB.js';

class MovieList extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      movieDataBase: this.props.movieDB,
      currentDB: this.props.movieDB,
      searchStr: "",
      addMovieStr: "",
      activateWatched: false,
      showWatched: false,
      showAddOnly: false
    };
    this.typeSearch = this.typeSearch.bind(this);
    this.searchMovies = this.searchMovies.bind(this);
    this.addMovie = this.addMovie.bind(this);
    this.typeMovie = this.typeMovie.bind(this);
    this.watchedToggle = this.watchedToggle.bind(this);
    this.viewWatch = this.viewWatch.bind(this);
  }

  componentDidMount() {}
  typeSearch(e) {
    e.preventDefault();
    this.setState({ searchStr: e.target.value });
  }

  typeMovie(e) {
    e.preventDefault();
    this.setState({ addMovieStr: e.target.value });
  }

  updateDB() {
    var m = this.state.movieDataBase.map(i => {
      var showW = this.state.activateWatched ? this.state.showWatched ? i.watched : !i.watched : true;
      var showAdd = this.state.showAddOnly ? i.showAdd : !i.showAdd;
      i.show = [showW, i.filter].reduce((i, j) => i && j);
      return i;
    });
    this.setState({
      currentDB: m.filter(i => i.show)
    });
  }
  searchMovies() {
    // searchMovieDB(this.state.searchStr);
    return new Promise((resolve, reject) => {
      var q = this.state.searchStr;
      resolve(q);
    }).then(q => {
      var m = this.state.movieDataBase.map(i => {
        i.filter = i.title.includes(q);
        return i;
      });
      this.setState({ movieDataBase: m });
      this.updateDB();
    });
  }

  watchedToggle(e, movie) {
    let currentTitle = movie.title;
    let m = this.state.movieDataBase.map(i => {
      if (i.title === currentTitle) {
        i.watched = !i.watched;
      }
      return i;
    });
    this.setState({
      movieDataBase: m
    }, this.updateDB());
    ;
  }

  addMovie(e) {
    e.preventDefault();
    // way I  
    // var p =  new Promise((resolve, reject)=>{
    //   this.setState({
    //       movieDataBase: this.state.movieDataBase.concat([{title : this.state.addMovieStr}])
    //     });
    //   resolve();
    // }).then( ()=>{
    //     this.searchMovies(this.state.searchStr);
    //   }
    // )
    // way II 
    this.setState({
      movieDataBase: this.state.movieDataBase.concat([{
        title: this.state.addMovieStr,
        added: true,
        watched: false,
        show: true,
        filter: true
      }])
    }, () => {
      this.searchMovies(this.state.searchStr);
    });
  }

  viewWatch(e) {
    switch (e.target.id) {
      case 'watched':
        this.setState({ showWatched: true, activateWatched: true }, () => {
          this.updateDB();
        });
        return;
      case 'new':
        this.setState({ showWatched: false, activateWatched: true }, () => {
          this.updateDB();
        });
        return;
      case 'reset':
        this.setState({ showWatched: false, activateWatched: false }, () => {
          this.updateDB();
        });
        return;
    }
  }
  render() {
    const buttons = ['watched', 'new', 'reset'].map((val, idx) => React.createElement(
      'button',
      { key: idx.toString(), className: 'watchToggleButton', id: val, onClick: this.viewWatch },
      val
    ));
    console.log(buttons);
    return React.createElement(
      'div',
      { className: 'movie-list' },
      React.createElement(
        'div',
        null,
        buttons
      ),
      React.createElement(
        'div',
        null,
        React.createElement(Movies, { currentDB: this.state.currentDB, watchedToggle: this.watchedToggle })
      ),
      React.createElement(Search, { typeSearch: this.typeSearch, searchMovies: this.searchMovies }),
      React.createElement(Add, { typeMovie: this.typeMovie, addMovie: this.addMovie })
    );
  }
};

MovieList.propTypes = {
  movieDB: React.PropTypes.array.isRequired
};
export default MovieList;
window.MovieList = MovieList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvbXBvbmVudHMvTW92aWVMaXN0LmpzIl0sIm5hbWVzIjpbIk1vdmllcyIsIlNlYXJjaCIsIkFkZCIsInNlYXJjaE1vdmllREIiLCJNb3ZpZUxpc3QiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdGF0ZSIsIm1vdmllRGF0YUJhc2UiLCJtb3ZpZURCIiwiY3VycmVudERCIiwic2VhcmNoU3RyIiwiYWRkTW92aWVTdHIiLCJhY3RpdmF0ZVdhdGNoZWQiLCJzaG93V2F0Y2hlZCIsInNob3dBZGRPbmx5IiwidHlwZVNlYXJjaCIsImJpbmQiLCJzZWFyY2hNb3ZpZXMiLCJhZGRNb3ZpZSIsInR5cGVNb3ZpZSIsIndhdGNoZWRUb2dnbGUiLCJ2aWV3V2F0Y2giLCJjb21wb25lbnREaWRNb3VudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNldFN0YXRlIiwidGFyZ2V0IiwidmFsdWUiLCJ1cGRhdGVEQiIsIm0iLCJtYXAiLCJpIiwic2hvd1ciLCJ3YXRjaGVkIiwic2hvd0FkZCIsInNob3ciLCJmaWx0ZXIiLCJyZWR1Y2UiLCJqIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJxIiwidGhlbiIsInRpdGxlIiwiaW5jbHVkZXMiLCJtb3ZpZSIsImN1cnJlbnRUaXRsZSIsImNvbmNhdCIsImFkZGVkIiwiaWQiLCJyZW5kZXIiLCJidXR0b25zIiwidmFsIiwiaWR4IiwidG9TdHJpbmciLCJjb25zb2xlIiwibG9nIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwid2luZG93Il0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxNQUFQLE1BQW1CLGFBQW5CO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixhQUFuQjtBQUNBLE9BQU9DLEdBQVAsTUFBZ0IsVUFBaEI7QUFDQSxPQUFPQyxhQUFQLE1BQTBCLHFCQUExQjs7QUFFQSxNQUFNQyxTQUFOLFNBQXdCQyxNQUFNQyxTQUE5QixDQUF3QztB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UCxHQUFtQkEsU0FBbkIiLCJmaWxlIjoiTW92aWVMaXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1vdmllcyBmcm9tICcuL01vdmllcy5qcyc7XG5pbXBvcnQgU2VhcmNoIGZyb20gJy4vU2VhcmNoLmpzJztcbmltcG9ydCBBZGQgZnJvbSAnLi9BZGQuanMnO1xuaW1wb3J0IHNlYXJjaE1vdmllREIgZnJvbSAnLi4vc2VhcmNoTW92aWVEQi5qcydcblxuY2xhc3MgTW92aWVMaXN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIG1vdmllRGF0YUJhc2U6IHRoaXMucHJvcHMubW92aWVEQixcbiAgICAgIGN1cnJlbnREQjogdGhpcy5wcm9wcy5tb3ZpZURCLFxuICAgICAgc2VhcmNoU3RyOiBcIlwiLFxuICAgICAgYWRkTW92aWVTdHI6IFwiXCIsXG4gICAgICBhY3RpdmF0ZVdhdGNoZWQ6IGZhbHNlLFxuICAgICAgc2hvd1dhdGNoZWQ6IGZhbHNlLFxuICAgICAgc2hvd0FkZE9ubHk6IGZhbHNlXG4gICAgfVxuICAgIHRoaXMudHlwZVNlYXJjaCA9IHRoaXMudHlwZVNlYXJjaC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuc2VhcmNoTW92aWVzID0gdGhpcy5zZWFyY2hNb3ZpZXMuYmluZCh0aGlzKTtcbiAgICB0aGlzLmFkZE1vdmllID0gdGhpcy5hZGRNb3ZpZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMudHlwZU1vdmllID0gdGhpcy50eXBlTW92aWUuYmluZCh0aGlzKTtcbiAgICB0aGlzLndhdGNoZWRUb2dnbGUgPSB0aGlzLndhdGNoZWRUb2dnbGUuYmluZCh0aGlzKTtcbiAgICB0aGlzLnZpZXdXYXRjaCA9IHRoaXMudmlld1dhdGNoLmJpbmQodGhpcyk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgfVxuICB0eXBlU2VhcmNoKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaFN0cjogZS50YXJnZXQudmFsdWUgfSlcbiAgfVxuXG4gIHR5cGVNb3ZpZShlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBhZGRNb3ZpZVN0cjogZS50YXJnZXQudmFsdWUgfSlcbiAgfVxuXG4gIHVwZGF0ZURCKCkge1xuICAgIHZhciBtID0gdGhpcy5zdGF0ZS5tb3ZpZURhdGFCYXNlLm1hcChpID0+IHtcbiAgICAgIHZhciBzaG93VyA9IHRoaXMuc3RhdGUuYWN0aXZhdGVXYXRjaGVkID8gKHRoaXMuc3RhdGUuc2hvd1dhdGNoZWQgPyBpLndhdGNoZWQgOiAhaS53YXRjaGVkKSA6IHRydWU7XG4gICAgICB2YXIgc2hvd0FkZCA9IHRoaXMuc3RhdGUuc2hvd0FkZE9ubHkgPyBpLnNob3dBZGQgOiAhaS5zaG93QWRkO1xuICAgICAgaS5zaG93ID0gW3Nob3dXLCBpLmZpbHRlcl0ucmVkdWNlKChpLCBqKSA9PiBpICYmIGopO1xuICAgICAgcmV0dXJuIGk7XG4gICAgfSlcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGN1cnJlbnREQjogbS5maWx0ZXIoaSA9PiBpLnNob3cpLFxuICAgIH0pXG4gIH1cbiAgc2VhcmNoTW92aWVzKCkge1xuICAgIC8vIHNlYXJjaE1vdmllREIodGhpcy5zdGF0ZS5zZWFyY2hTdHIpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB2YXIgcSA9IHRoaXMuc3RhdGUuc2VhcmNoU3RyO1xuICAgICAgcmVzb2x2ZShxKTtcbiAgICB9KS50aGVuKChxKSA9PiB7XG4gICAgICB2YXIgbSA9IHRoaXMuc3RhdGUubW92aWVEYXRhQmFzZS5tYXAoKGkpID0+IHtcbiAgICAgICAgaS5maWx0ZXIgPSBpLnRpdGxlLmluY2x1ZGVzKHEpXG4gICAgICAgIHJldHVybiBpO1xuICAgICAgfSlcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBtb3ZpZURhdGFCYXNlOiBtIH0pXG4gICAgICB0aGlzLnVwZGF0ZURCKClcbiAgICB9XG4gICAgKVxuICB9XG5cbiAgd2F0Y2hlZFRvZ2dsZShlLCBtb3ZpZSkge1xuICAgIGxldCBjdXJyZW50VGl0bGUgPSBtb3ZpZS50aXRsZTtcbiAgICBsZXQgbSA9IHRoaXMuc3RhdGUubW92aWVEYXRhQmFzZS5tYXAoaSA9PiB7XG4gICAgICBpZiAoaS50aXRsZSA9PT0gY3VycmVudFRpdGxlKSB7XG4gICAgICAgIGkud2F0Y2hlZCA9ICFpLndhdGNoZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gaTtcbiAgICB9KVxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgbW92aWVEYXRhQmFzZTogbVxuICAgIH0sIHRoaXMudXBkYXRlREIoKSk7XG4gICAgO1xuICB9XG5cbiAgYWRkTW92aWUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyB3YXkgSSAgXG4gICAgLy8gdmFyIHAgPSAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PntcbiAgICAvLyAgIHRoaXMuc2V0U3RhdGUoe1xuICAgIC8vICAgICAgIG1vdmllRGF0YUJhc2U6IHRoaXMuc3RhdGUubW92aWVEYXRhQmFzZS5jb25jYXQoW3t0aXRsZSA6IHRoaXMuc3RhdGUuYWRkTW92aWVTdHJ9XSlcbiAgICAvLyAgICAgfSk7XG4gICAgLy8gICByZXNvbHZlKCk7XG4gICAgLy8gfSkudGhlbiggKCk9PntcbiAgICAvLyAgICAgdGhpcy5zZWFyY2hNb3ZpZXModGhpcy5zdGF0ZS5zZWFyY2hTdHIpO1xuICAgIC8vICAgfVxuICAgIC8vIClcbiAgICAvLyB3YXkgSUkgXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBtb3ZpZURhdGFCYXNlOiB0aGlzLnN0YXRlLm1vdmllRGF0YUJhc2UuY29uY2F0KFtcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiB0aGlzLnN0YXRlLmFkZE1vdmllU3RyLFxuICAgICAgICAgIGFkZGVkOiB0cnVlLFxuICAgICAgICAgIHdhdGNoZWQ6IGZhbHNlLFxuICAgICAgICAgIHNob3c6IHRydWUsXG4gICAgICAgICAgZmlsdGVyOiB0cnVlLFxuICAgICAgICB9XSlcbiAgICB9LCAoKSA9PiB7IHRoaXMuc2VhcmNoTW92aWVzKHRoaXMuc3RhdGUuc2VhcmNoU3RyKTsgfSk7XG4gIH1cblxuXG4gIHZpZXdXYXRjaChlKSB7XG4gICAgc3dpdGNoIChlLnRhcmdldC5pZCkge1xuICAgICAgY2FzZSAnd2F0Y2hlZCc6XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93V2F0Y2hlZDogdHJ1ZSwgYWN0aXZhdGVXYXRjaGVkOiB0cnVlIH0sICgpID0+IHsgdGhpcy51cGRhdGVEQigpIH0pXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNhc2UgJ25ldyc6XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93V2F0Y2hlZDogZmFsc2UsIGFjdGl2YXRlV2F0Y2hlZDogdHJ1ZSB9LCAoKSA9PiB7IHRoaXMudXBkYXRlREIoKSB9KVxuICAgICAgICByZXR1cm47XG4gICAgICBjYXNlICdyZXNldCc6XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzaG93V2F0Y2hlZDogZmFsc2UsIGFjdGl2YXRlV2F0Y2hlZDogZmFsc2UgfSwgKCkgPT4geyB0aGlzLnVwZGF0ZURCKCkgfSlcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgYnV0dG9ucyA9IFsnd2F0Y2hlZCcsICduZXcnLCAncmVzZXQnXS5tYXAoICh2YWwsIGlkeCkgPT4gKFxuICAgICAgPGJ1dHRvbiBrZXk9e2lkeC50b1N0cmluZygpfSBjbGFzc05hbWU9J3dhdGNoVG9nZ2xlQnV0dG9uJyBpZD17dmFsfSBvbkNsaWNrPXt0aGlzLnZpZXdXYXRjaH0+e3ZhbH08L2J1dHRvbj5cbiAgICApKVxuICAgIGNvbnNvbGUubG9nKGJ1dHRvbnMpO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1vdmllLWxpc3RcIj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICB7YnV0dG9uc31cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPE1vdmllcyBjdXJyZW50REI9e3RoaXMuc3RhdGUuY3VycmVudERCfSB3YXRjaGVkVG9nZ2xlPXt0aGlzLndhdGNoZWRUb2dnbGV9IC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8U2VhcmNoIHR5cGVTZWFyY2g9e3RoaXMudHlwZVNlYXJjaH0gc2VhcmNoTW92aWVzPXt0aGlzLnNlYXJjaE1vdmllc30gLz5cbiAgICAgICAgPEFkZCB0eXBlTW92aWU9e3RoaXMudHlwZU1vdmllfSBhZGRNb3ZpZT17dGhpcy5hZGRNb3ZpZX0gLz5cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfVxufTtcblxuTW92aWVMaXN0LnByb3BUeXBlcyA9IHtcbiAgbW92aWVEQjogUmVhY3QuUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWRcbn07XG5leHBvcnQgZGVmYXVsdCBNb3ZpZUxpc3Q7XG53aW5kb3cuTW92aWVMaXN0ID0gTW92aWVMaXN0OyJdfQ==