import Movies from './Movies.js';
import Search from './Search.js';
import Add from './Add.js';

class MovieList extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      movieDataBase: this.props.movieDB,
      currentDB: this.props.movieDB,
      searchStr: "",
      addMovieStr: "",
      activateWatched: false,
      showWatched: false,
      showAddOnly: false
    };
    this.typeSearch = this.typeSearch.bind(this);
    this.searchMovies = this.searchMovies.bind(this);
    this.addMovie = this.addMovie.bind(this);
    this.typeMovie = this.typeMovie.bind(this);
    this.watchedToggle = this.watchedToggle.bind(this);
    this.viewWatch = this.viewWatch.bind(this);
  }

  componentDidMount() {}
  typeSearch(e) {
    e.preventDefault();
    this.setState({ searchStr: e.target.value });
  }

  typeMovie(e) {
    e.preventDefault();
    this.setState({ addMovieStr: e.target.value });
  }

  updateDB() {
    var m = this.state.movieDataBase.map(i => {
      var showW = this.state.activateWatched ? this.state.showWatched ? i.watched : !i.watched : true;
      var showAdd = this.state.showAddOnly ? i.showAdd : !i.showAdd;
      i.show = [showW, i.filter].reduce((i, j) => i && j);
      return i;
    });
    this.setState({
      currentDB: m.filter(i => i.show)
    });
  }
  searchMovies(q) {
    return new Promise((resolve, reject) => {
      var q = this.state.searchStr;
      resolve(q);
    }).then(q => {
      var m = this.state.movieDataBase.map(i => {
        i.filter = i.title.includes(q);
        return i;
      });
      this.setState({ movieDataBase: m });
      this.updateDB();
    });
  }

  watchedToggle(e, movie) {
    let currentTitle = movie.title;
    let m = this.state.movieDataBase.map(i => {
      if (i.title === currentTitle) {
        i.watched = !i.watched;
      }
      return i;
    });
    this.setState({
      movieDataBase: m
    }, this.updateDB());
    ;
  }

  addMovie(e) {
    e.preventDefault();
    // way I  
    // var p =  new Promise((resolve, reject)=>{
    //   this.setState({
    //       movieDataBase: this.state.movieDataBase.concat([{title : this.state.addMovieStr}])
    //     });
    //   resolve();
    // }).then( ()=>{
    //     this.searchMovies(this.state.searchStr);
    //   }
    // )
    // way II 
    this.setState({
      movieDataBase: this.state.movieDataBase.concat([{
        title: this.state.addMovieStr,
        added: true,
        watched: false,
        show: true,
        filter: true
      }])
    }, () => {
      this.searchMovies(this.state.searchStr);
    });
  }

  viewWatch(e) {
    switch (e.target.id) {
      case 'watched':
        this.setState({ showWatched: true, activateWatched: true }, () => {
          this.updateDB();
        });
        return;
      case 'new':
        this.setState({ showWatched: false, activateWatched: true }, () => {
          this.updateDB();
        });
        return;
      case 'reset':
        this.setState({ showWatched: false, activateWatched: false }, () => {
          this.updateDB();
        });
        return;

    }
    // if(e.target.id==='watched'){
    // } else if (e.target.id==='new'){
    //   this.setState({showWatched : false, activateWatched:true}, ()=> {this.updateDB()});
    // }
  }
  render() {
    return React.createElement(
      'div',
      { className: 'movie-list' },
      React.createElement(
        'div',
        null,
        React.createElement(
          'button',
          { className: 'watchToggleButton', id: 'watched', onClick: this.viewWatch },
          'rewatch!'
        ),
        React.createElement(
          'button',
          { className: 'watchToggleButton', id: 'new', onClick: this.viewWatch },
          'new!'
        ),
        React.createElement(
          'button',
          { className: 'watchToggleButton', id: 'reset', onClick: this.viewWatch },
          'reset toggle'
        )
      ),
      React.createElement(
        'div',
        null,
        React.createElement(Movies, { currentDB: this.state.currentDB, watchedToggle: this.watchedToggle })
      ),
      React.createElement(Search, { typeSearch: this.typeSearch, searchMovies: this.searchMovies }),
      React.createElement(Add, { typeMovie: this.typeMovie, addMovie: this.addMovie })
    );
  }
};

MovieList.propTypes = {
  movieDB: React.PropTypes.array.isRequired
};
export default MovieList;
window.MovieList = MovieList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvbXBvbmVudHMvTW92aWVMaXN0LmpzIl0sIm5hbWVzIjpbIk1vdmllcyIsIlNlYXJjaCIsIkFkZCIsIk1vdmllTGlzdCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwibW92aWVEYXRhQmFzZSIsIm1vdmllREIiLCJjdXJyZW50REIiLCJzZWFyY2hTdHIiLCJhZGRNb3ZpZVN0ciIsImFjdGl2YXRlV2F0Y2hlZCIsInNob3dXYXRjaGVkIiwic2hvd0FkZE9ubHkiLCJ0eXBlU2VhcmNoIiwiYmluZCIsInNlYXJjaE1vdmllcyIsImFkZE1vdmllIiwidHlwZU1vdmllIiwid2F0Y2hlZFRvZ2dsZSIsInZpZXdXYXRjaCIsImNvbXBvbmVudERpZE1vdW50IiwiZSIsInByZXZlbnREZWZhdWx0Iiwic2V0U3RhdGUiLCJ0YXJnZXQiLCJ2YWx1ZSIsInVwZGF0ZURCIiwibSIsIm1hcCIsImkiLCJzaG93VyIsIndhdGNoZWQiLCJzaG93QWRkIiwic2hvdyIsImZpbHRlciIsInJlZHVjZSIsImoiLCJxIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ0aGVuIiwidGl0bGUiLCJpbmNsdWRlcyIsIm1vdmllIiwiY3VycmVudFRpdGxlIiwiY29uY2F0IiwiYWRkZWQiLCJpZCIsInJlbmRlciIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImFycmF5IiwiaXNSZXF1aXJlZCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsTUFBUCxNQUFtQixhQUFuQjtBQUNBLE9BQU9DLE1BQVAsTUFBbUIsYUFBbkI7QUFDQSxPQUFPQyxHQUFQLE1BQWdCLFVBQWhCOztBQUVBLE1BQU1DLFNBQU4sU0FBd0JDLE1BQU1DLFNBQTlCLENBQXdDO0FBQ3RDQyxjQUFZQyxLQUFaLEVBQW1CO0FBQ2pCLFVBQU1BLEtBQU47QUFDQSxTQUFLQyxLQUFMLEdBQWE7QUFDWEMscUJBQWUsS0FBS0YsS0FBTCxDQUFXRyxPQURm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cnQgTW92aWVzIGZyb20gJy4vTW92aWVzLmpzJztcbmltcG9ydCBTZWFyY2ggZnJvbSAnLi9TZWFyY2guanMnO1xuaW1wb3J0IEFkZCBmcm9tICcuL0FkZC5qcyc7XG5cbmNsYXNzIE1vdmllTGlzdCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBtb3ZpZURhdGFCYXNlOiB0aGlzLnByb3BzLm1vdmllREIsXG4gICAgICBjdXJyZW50REI6IHRoaXMucHJvcHMubW92aWVEQixcbiAgICAgIHNlYXJjaFN0cjogXCJcIixcbiAgICAgIGFkZE1vdmllU3RyOiBcIlwiLFxuICAgICAgYWN0aXZhdGVXYXRjaGVkOiBmYWxzZSxcbiAgICAgIHNob3dXYXRjaGVkOiBmYWxzZSxcbiAgICAgIHNob3dBZGRPbmx5OiBmYWxzZVxuICAgIH1cbiAgICB0aGlzLnR5cGVTZWFyY2ggPSB0aGlzLnR5cGVTZWFyY2guYmluZCh0aGlzKTtcbiAgICB0aGlzLnNlYXJjaE1vdmllcyA9IHRoaXMuc2VhcmNoTW92aWVzLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGRNb3ZpZSA9IHRoaXMuYWRkTW92aWUuYmluZCh0aGlzKTtcbiAgICB0aGlzLnR5cGVNb3ZpZSA9IHRoaXMudHlwZU1vdmllLmJpbmQodGhpcyk7XG4gICAgdGhpcy53YXRjaGVkVG9nZ2xlID0gdGhpcy53YXRjaGVkVG9nZ2xlLmJpbmQodGhpcyk7XG4gICAgdGhpcy52aWV3V2F0Y2ggPSB0aGlzLnZpZXdXYXRjaC5iaW5kKHRoaXMpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gIH1cbiAgdHlwZVNlYXJjaChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hTdHI6IGUudGFyZ2V0LnZhbHVlIH0pXG4gIH1cblxuICB0eXBlTW92aWUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgYWRkTW92aWVTdHI6IGUudGFyZ2V0LnZhbHVlIH0pXG4gIH1cblxuICB1cGRhdGVEQigpIHtcbiAgICB2YXIgbSA9IHRoaXMuc3RhdGUubW92aWVEYXRhQmFzZS5tYXAoaSA9PiB7XG4gICAgICB2YXIgc2hvd1cgPSB0aGlzLnN0YXRlLmFjdGl2YXRlV2F0Y2hlZCA/ICh0aGlzLnN0YXRlLnNob3dXYXRjaGVkID8gaS53YXRjaGVkIDogIWkud2F0Y2hlZCkgOiB0cnVlO1xuICAgICAgdmFyIHNob3dBZGQgPSB0aGlzLnN0YXRlLnNob3dBZGRPbmx5ID8gaS5zaG93QWRkIDogIWkuc2hvd0FkZDtcbiAgICAgIGkuc2hvdyA9IFtzaG93VywgaS5maWx0ZXJdLnJlZHVjZSgoaSwgaikgPT4gaSAmJiBqKTtcbiAgICAgIHJldHVybiBpO1xuICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBjdXJyZW50REI6IG0uZmlsdGVyKGkgPT4gaS5zaG93KSxcbiAgICB9KVxuICB9XG4gIHNlYXJjaE1vdmllcyhxKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHZhciBxID0gdGhpcy5zdGF0ZS5zZWFyY2hTdHI7XG4gICAgICByZXNvbHZlKHEpO1xuICAgIH0pLnRoZW4oKHEpID0+IHtcbiAgICAgIHZhciBtID0gdGhpcy5zdGF0ZS5tb3ZpZURhdGFCYXNlLm1hcCgoaSkgPT4ge1xuICAgICAgICBpLmZpbHRlciA9IGkudGl0bGUuaW5jbHVkZXMocSlcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9KVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7IG1vdmllRGF0YUJhc2U6IG0gfSlcbiAgICAgIHRoaXMudXBkYXRlREIoKVxuICAgIH1cbiAgICApXG4gIH1cblxuICB3YXRjaGVkVG9nZ2xlKGUsIG1vdmllKSB7XG4gICAgbGV0IGN1cnJlbnRUaXRsZSA9IG1vdmllLnRpdGxlO1xuICAgIGxldCBtID0gdGhpcy5zdGF0ZS5tb3ZpZURhdGFCYXNlLm1hcChpID0+IHtcbiAgICAgIGlmIChpLnRpdGxlID09PSBjdXJyZW50VGl0bGUpIHtcbiAgICAgICAgaS53YXRjaGVkID0gIWkud2F0Y2hlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBpO1xuICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBtb3ZpZURhdGFCYXNlOiBtXG4gICAgfSwgdGhpcy51cGRhdGVEQigpKTtcbiAgICA7XG4gIH1cblxuICBhZGRNb3ZpZShlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vIHdheSBJICBcbiAgICAvLyB2YXIgcCA9ICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xuICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgLy8gICAgICAgbW92aWVEYXRhQmFzZTogdGhpcy5zdGF0ZS5tb3ZpZURhdGFCYXNlLmNvbmNhdChbe3RpdGxlIDogdGhpcy5zdGF0ZS5hZGRNb3ZpZVN0cn1dKVxuICAgIC8vICAgICB9KTtcbiAgICAvLyAgIHJlc29sdmUoKTtcbiAgICAvLyB9KS50aGVuKCAoKT0+e1xuICAgIC8vICAgICB0aGlzLnNlYXJjaE1vdmllcyh0aGlzLnN0YXRlLnNlYXJjaFN0cik7XG4gICAgLy8gICB9XG4gICAgLy8gKVxuICAgIC8vIHdheSBJSSBcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIG1vdmllRGF0YUJhc2U6IHRoaXMuc3RhdGUubW92aWVEYXRhQmFzZS5jb25jYXQoW1xuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IHRoaXMuc3RhdGUuYWRkTW92aWVTdHIsXG4gICAgICAgICAgYWRkZWQ6IHRydWUsXG4gICAgICAgICAgd2F0Y2hlZDogZmFsc2UsXG4gICAgICAgICAgc2hvdzogdHJ1ZSxcbiAgICAgICAgICBmaWx0ZXI6IHRydWUsXG4gICAgICAgIH1dKVxuICAgIH0sICgpID0+IHsgdGhpcy5zZWFyY2hNb3ZpZXModGhpcy5zdGF0ZS5zZWFyY2hTdHIpOyB9KTtcbiAgfVxuXG5cbiAgdmlld1dhdGNoKGUpIHtcbiAgICBzd2l0Y2ggKGUudGFyZ2V0LmlkKSB7XG4gICAgICBjYXNlICd3YXRjaGVkJzpcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dXYXRjaGVkOiB0cnVlLCBhY3RpdmF0ZVdhdGNoZWQ6IHRydWUgfSwgKCkgPT4geyB0aGlzLnVwZGF0ZURCKCkgfSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY2FzZSAnbmV3JzpcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dXYXRjaGVkOiBmYWxzZSwgYWN0aXZhdGVXYXRjaGVkOiB0cnVlIH0sICgpID0+IHsgdGhpcy51cGRhdGVEQigpIH0pXG4gICAgICAgIHJldHVybjtcbiAgICAgIGNhc2UgJ3Jlc2V0JzpcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNob3dXYXRjaGVkOiBmYWxzZSwgYWN0aXZhdGVXYXRjaGVkOiBmYWxzZSB9LCAoKSA9PiB7IHRoaXMudXBkYXRlREIoKSB9KVxuICAgICAgICByZXR1cm47XG5cblxuICAgIH1cbiAgICAvLyBpZihlLnRhcmdldC5pZD09PSd3YXRjaGVkJyl7XG4gICAgLy8gfSBlbHNlIGlmIChlLnRhcmdldC5pZD09PSduZXcnKXtcbiAgICAvLyAgIHRoaXMuc2V0U3RhdGUoe3Nob3dXYXRjaGVkIDogZmFsc2UsIGFjdGl2YXRlV2F0Y2hlZDp0cnVlfSwgKCk9PiB7dGhpcy51cGRhdGVEQigpfSk7XG4gICAgLy8gfVxuXG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1vdmllLWxpc3RcIj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nd2F0Y2hUb2dnbGVCdXR0b24nIGlkPSd3YXRjaGVkJyBvbkNsaWNrPXt0aGlzLnZpZXdXYXRjaH0+XG4gICAgICAgICAgICByZXdhdGNoIVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPSd3YXRjaFRvZ2dsZUJ1dHRvbicgaWQ9J25ldycgb25DbGljaz17dGhpcy52aWV3V2F0Y2h9PlxuICAgICAgICAgICAgbmV3IVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPSd3YXRjaFRvZ2dsZUJ1dHRvbicgaWQ9J3Jlc2V0JyBvbkNsaWNrPXt0aGlzLnZpZXdXYXRjaH0+XG4gICAgICAgICAgICByZXNldCB0b2dnbGVcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPE1vdmllcyBjdXJyZW50REI9e3RoaXMuc3RhdGUuY3VycmVudERCfSB3YXRjaGVkVG9nZ2xlPXt0aGlzLndhdGNoZWRUb2dnbGV9IC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8U2VhcmNoIHR5cGVTZWFyY2g9e3RoaXMudHlwZVNlYXJjaH0gc2VhcmNoTW92aWVzPXt0aGlzLnNlYXJjaE1vdmllc30gLz5cbiAgICAgICAgPEFkZCB0eXBlTW92aWU9e3RoaXMudHlwZU1vdmllfSBhZGRNb3ZpZT17dGhpcy5hZGRNb3ZpZX0gLz5cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfVxufTtcblxuTW92aWVMaXN0LnByb3BUeXBlcyA9IHtcbiAgbW92aWVEQjogUmVhY3QuUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWRcbn07XG5leHBvcnQgZGVmYXVsdCBNb3ZpZUxpc3Q7XG53aW5kb3cuTW92aWVMaXN0ID0gTW92aWVMaXN0OyJdfQ==