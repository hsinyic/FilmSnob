import Movies from './Movies.js';
import Search from './Search.js';
import Add from './Add.js';
import searchMovieDB from '../searchMovieDB.js';

class MovieList extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      movieDataBase: this.props.movieDB,
      currentDB: this.props.movieDB,
      searchStr: "",
      addMovieStr: "",
      activateWatched: false,
      showWatched: false,
      showAddOnly: false
    };
    this.typeSearch = this.typeSearch.bind(this);
    this.searchMovies = this.searchMovies.bind(this);
    this.addMovie = this.addMovie.bind(this);
    this.typeMovie = this.typeMovie.bind(this);
    this.watchedToggle = this.watchedToggle.bind(this);
    this.viewWatch = this.viewWatch.bind(this);
  }

  componentDidMount() {}
  typeSearch(e) {
    e.preventDefault();
    this.setState({ searchStr: e.target.value });
  }

  typeMovie(e) {
    e.preventDefault();
    this.setState({ addMovieStr: e.target.value });
  }

  updateDB() {
    var m = this.state.movieDataBase.map(i => {
      var showW = this.state.activateWatched ? this.state.showWatched ? i.watched : !i.watched : true;
      var showAdd = this.state.showAddOnly ? i.showAdd : !i.showAdd;
      i.show = [showW, i.filter].reduce((i, j) => i && j);
      return i;
    });
    this.setState({
      currentDB: m.filter(i => i.show)
    });
  }
  searchMovies() {
    searchMovieDB(this.state.searchStr);
    // return new Promise((resolve, reject) => {
    //   var q = this.state.searchStr;
    //   resolve(q);
    // }).then((q) => {
    //   var m = this.state.movieDataBase.map((i) => {
    //     i.filter = i.title.includes(q)
    //     return i;
    //   })
    //   this.setState({ movieDataBase: m })
    //   this.updateDB()
    // }
    // )
  }

  watchedToggle(e, movie) {
    let currentTitle = movie.title;
    let m = this.state.movieDataBase.map(i => {
      if (i.title === currentTitle) {
        i.watched = !i.watched;
      }
      return i;
    });
    this.setState({
      movieDataBase: m
    }, this.updateDB());
    ;
  }

  addMovie(e) {
    e.preventDefault();
    // way I  
    // var p =  new Promise((resolve, reject)=>{
    //   this.setState({
    //       movieDataBase: this.state.movieDataBase.concat([{title : this.state.addMovieStr}])
    //     });
    //   resolve();
    // }).then( ()=>{
    //     this.searchMovies(this.state.searchStr);
    //   }
    // )
    // way II 
    this.setState({
      movieDataBase: this.state.movieDataBase.concat([{
        title: this.state.addMovieStr,
        added: true,
        watched: false,
        show: true,
        filter: true
      }])
    }, () => {
      this.searchMovies(this.state.searchStr);
    });
  }

  viewWatch(e) {
    switch (e.target.id) {
      case 'watched':
        this.setState({ showWatched: true, activateWatched: true }, () => {
          this.updateDB();
        });
        return;
      case 'new':
        this.setState({ showWatched: false, activateWatched: true }, () => {
          this.updateDB();
        });
        return;
      case 'reset':
        this.setState({ showWatched: false, activateWatched: false }, () => {
          this.updateDB();
        });
        return;

    }
    // if(e.target.id==='watched'){
    // } else if (e.target.id==='new'){
    //   this.setState({showWatched : false, activateWatched:true}, ()=> {this.updateDB()});
    // }
  }
  render() {
    return React.createElement(
      'div',
      { className: 'movie-list' },
      React.createElement(
        'div',
        null,
        React.createElement(
          'button',
          { className: 'watchToggleButton', id: 'watched', onClick: this.viewWatch },
          'rewatch!'
        ),
        React.createElement(
          'button',
          { className: 'watchToggleButton', id: 'new', onClick: this.viewWatch },
          'new!'
        ),
        React.createElement(
          'button',
          { className: 'watchToggleButton', id: 'reset', onClick: this.viewWatch },
          'reset toggle'
        )
      ),
      React.createElement(
        'div',
        null,
        React.createElement(Movies, { currentDB: this.state.currentDB, watchedToggle: this.watchedToggle })
      ),
      React.createElement(Search, { typeSearch: this.typeSearch, searchMovies: this.searchMovies }),
      React.createElement(Add, { typeMovie: this.typeMovie, addMovie: this.addMovie })
    );
  }
};

MovieList.propTypes = {
  movieDB: React.PropTypes.array.isRequired
};
export default MovieList;
window.MovieList = MovieList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvbXBvbmVudHMvTW92aWVMaXN0LmpzIl0sIm5hbWVzIjpbIk1vdmllcyIsIlNlYXJjaCIsIkFkZCIsInNlYXJjaE1vdmllREIiLCJNb3ZpZUxpc3QiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJzdGF0ZSIsIm1vdmllRGF0YUJhc2UiLCJtb3ZpZURCIiwiY3VycmVudERCIiwic2VhcmNoU3RyIiwiYWRkTW92aWVTdHIiLCJhY3RpdmF0ZVdhdGNoZWQiLCJzaG93V2F0Y2hlZCIsInNob3dBZGRPbmx5IiwidHlwZVNlYXJjaCIsImJpbmQiLCJzZWFyY2hNb3ZpZXMiLCJhZGRNb3ZpZSIsInR5cGVNb3ZpZSIsIndhdGNoZWRUb2dnbGUiLCJ2aWV3V2F0Y2giLCJjb21wb25lbnREaWRNb3VudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNldFN0YXRlIiwidGFyZ2V0IiwidmFsdWUiLCJ1cGRhdGVEQiIsIm0iLCJtYXAiLCJpIiwic2hvd1ciLCJ3YXRjaGVkIiwic2hvd0FkZCIsInNob3ciLCJmaWx0ZXIiLCJyZWR1Y2UiLCJqIiwibW92aWUiLCJjdXJyZW50VGl0bGUiLCJ0aXRsZSIsImNvbmNhdCIsImFkZGVkIiwiaWQiLCJyZW5kZXIiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJhcnJheSIsImlzUmVxdWlyZWQiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLE1BQVAsTUFBbUIsYUFBbkI7QUFDQSxPQUFPQyxNQUFQLE1BQW1CLGFBQW5CO0FBQ0EsT0FBT0MsR0FBUCxNQUFnQixVQUFoQjtBQUNBLE9BQU9DLGFBQVAsTUFBMEIscUJBQTFCOztBQUVBLE1BQU1DLFNBQU4sU0FBd0JDLE1BQU1DLFNBQTlCLENBQXdDO0FBQ3RDQyxjQUFZQyxLQUFaLEVBQW1CO0FBQ2pCLFVBQU1BLEtBQU47QUFDQSxTQUFLQyxLQUFMLEdBQWE7QUFDWEMscUJBQWUsS0FBS0YsS0FBTCxDQUFXRyxPQURmO0FBRVhD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bEIsRUFBc0MsSUFBRyxLQUF6QyxFQUErQyxTQUFTLEtBQUtBLFNBQTdEO0FBQUE7QUFBQSxTQUpGO0FBT0U7QUFBQTtBQUFBLFlBQVEsV0FBVSxtQkFBbEIsRUFBc0MsSUFBRyxPQUF6QyxFQUFpRCxTQUFTLEtBQUtBLFNBQS9EO0FBQUE7QUFBQTtBQVBGLE9BREY7QUFZRTtBQUFBO0FBQUE7QUFDRSw0QkFBQyxNQUFELElBQVEsV0FBVyxLQUFLZixLQUFMLENBQVdHLFNBQTlCLEVBQXlDLGVBQWUsS0FBS1csYUFBN0Q7QUFERixPQVpGO0FBZUUsMEJBQUMsTUFBRCxJQUFRLFlBQVksS0FBS0wsVUFBekIsRUFBcUMsY0FBYyxLQUFLRSxZQUF4RCxHQWZGO0FBZ0JFLDBCQUFDLEdBQUQsSUFBSyxXQUFXLEtBQUtFLFNBQXJCLEVBQWdDLFVBQVUsS0FBS0QsUUFBL0M7QUFoQkYsS0FERjtBQW9CRDtBQTNJcUMsQ0E0SXZDOztBQUVEakIsVUFBVTZDLFNBQVYsR0FBc0I7QUFDcEJ0QyxXQUFTTixNQUFNNkMsU0FBTixDQUFnQkMsS0FBaEIsQ0FBc0JDO0FBRFgsQ0FBdEI7QUFHQSxlQUFlaEQsU0FBZjtBQUNBaUQsT0FBT2pELFNBQVAsR0FBbUJBLFNBQW5CIiwiZmlsZSI6Ik1vdmllTGlzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNb3ZpZXMgZnJvbSAnLi9Nb3ZpZXMuanMnO1xuaW1wb3J0IFNlYXJjaCBmcm9tICcuL1NlYXJjaC5qcyc7XG5pbXBvcnQgQWRkIGZyb20gJy4vQWRkLmpzJztcbmltcG9ydCBzZWFyY2hNb3ZpZURCIGZyb20gJy4uL3NlYXJjaE1vdmllREIuanMnXG5cbmNsYXNzIE1vdmllTGlzdCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBtb3ZpZURhdGFCYXNlOiB0aGlzLnByb3BzLm1vdmllREIsXG4gICAgICBjdXJyZW50REI6IHRoaXMucHJvcHMubW92aWVEQixcbiAgICAgIHNlYXJjaFN0cjogXCJcIixcbiAgICAgIGFkZE1vdmllU3RyOiBcIlwiLFxuICAgICAgYWN0aXZhdGVXYXRjaGVkOiBmYWxzZSxcbiAgICAgIHNob3dXYXRjaGVkOiBmYWxzZSxcbiAgICAgIHNob3dBZGRPbmx5OiBmYWxzZVxuICAgIH1cbiAgICB0aGlzLnR5cGVTZWFyY2ggPSB0aGlzLnR5cGVTZWFyY2guYmluZCh0aGlzKTtcbiAgICB0aGlzLnNlYXJjaE1vdmllcyA9IHRoaXMuc2VhcmNoTW92aWVzLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGRNb3ZpZSA9IHRoaXMuYWRkTW92aWUuYmluZCh0aGlzKTtcbiAgICB0aGlzLnR5cGVNb3ZpZSA9IHRoaXMudHlwZU1vdmllLmJpbmQodGhpcyk7XG4gICAgdGhpcy53YXRjaGVkVG9nZ2xlID0gdGhpcy53YXRjaGVkVG9nZ2xlLmJpbmQodGhpcyk7XG4gICAgdGhpcy52aWV3V2F0Y2ggPSB0aGlzLnZpZXdXYXRjaC5iaW5kKHRoaXMpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gIH1cbiAgdHlwZVNlYXJjaChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hTdHI6IGUudGFyZ2V0LnZhbHVlIH0pXG4gIH1cblxuICB0eXBlTW92aWUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgYWRkTW92aWVTdHI6IGUudGFyZ2V0LnZhbHVlIH0pXG4gIH1cblxuICB1cGRhdGVEQigpIHtcbiAgICB2YXIgbSA9IHRoaXMuc3RhdGUubW92aWVEYXRhQmFzZS5tYXAoaSA9PiB7XG4gICAgICB2YXIgc2hvd1cgPSB0aGlzLnN0YXRlLmFjdGl2YXRlV2F0Y2hlZCA/ICh0aGlzLnN0YXRlLnNob3dXYXRjaGVkID8gaS53YXRjaGVkIDogIWkud2F0Y2hlZCkgOiB0cnVlO1xuICAgICAgdmFyIHNob3dBZGQgPSB0aGlzLnN0YXRlLnNob3dBZGRPbmx5ID8gaS5zaG93QWRkIDogIWkuc2hvd0FkZDtcbiAgICAgIGkuc2hvdyA9IFtzaG93VywgaS5maWx0ZXJdLnJlZHVjZSgoaSwgaikgPT4gaSAmJiBqKTtcbiAgICAgIHJldHVybiBpO1xuICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBjdXJyZW50REI6IG0uZmlsdGVyKGkgPT4gaS5zaG93KSxcbiAgICB9KVxuICB9XG4gIHNlYXJjaE1vdmllcygpIHtcbiAgICBzZWFyY2hNb3ZpZURCKHRoaXMuc3RhdGUuc2VhcmNoU3RyKTtcbiAgICAvLyByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIC8vICAgdmFyIHEgPSB0aGlzLnN0YXRlLnNlYXJjaFN0cjtcbiAgICAvLyAgIHJlc29sdmUocSk7XG4gICAgLy8gfSkudGhlbigocSkgPT4ge1xuICAgIC8vICAgdmFyIG0gPSB0aGlzLnN0YXRlLm1vdmllRGF0YUJhc2UubWFwKChpKSA9PiB7XG4gICAgLy8gICAgIGkuZmlsdGVyID0gaS50aXRsZS5pbmNsdWRlcyhxKVxuICAgIC8vICAgICByZXR1cm4gaTtcbiAgICAvLyAgIH0pXG4gICAgLy8gICB0aGlzLnNldFN0YXRlKHsgbW92aWVEYXRhQmFzZTogbSB9KVxuICAgIC8vICAgdGhpcy51cGRhdGVEQigpXG4gICAgLy8gfVxuICAgIC8vIClcbiAgfVxuXG4gIHdhdGNoZWRUb2dnbGUoZSwgbW92aWUpIHtcbiAgICBsZXQgY3VycmVudFRpdGxlID0gbW92aWUudGl0bGU7XG4gICAgbGV0IG0gPSB0aGlzLnN0YXRlLm1vdmllRGF0YUJhc2UubWFwKGkgPT4ge1xuICAgICAgaWYgKGkudGl0bGUgPT09IGN1cnJlbnRUaXRsZSkge1xuICAgICAgICBpLndhdGNoZWQgPSAhaS53YXRjaGVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGk7XG4gICAgfSlcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIG1vdmllRGF0YUJhc2U6IG1cbiAgICB9LCB0aGlzLnVwZGF0ZURCKCkpO1xuICAgIDtcbiAgfVxuXG4gIGFkZE1vdmllKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gd2F5IEkgIFxuICAgIC8vIHZhciBwID0gIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57XG4gICAgLy8gICB0aGlzLnNldFN0YXRlKHtcbiAgICAvLyAgICAgICBtb3ZpZURhdGFCYXNlOiB0aGlzLnN0YXRlLm1vdmllRGF0YUJhc2UuY29uY2F0KFt7dGl0bGUgOiB0aGlzLnN0YXRlLmFkZE1vdmllU3RyfV0pXG4gICAgLy8gICAgIH0pO1xuICAgIC8vICAgcmVzb2x2ZSgpO1xuICAgIC8vIH0pLnRoZW4oICgpPT57XG4gICAgLy8gICAgIHRoaXMuc2VhcmNoTW92aWVzKHRoaXMuc3RhdGUuc2VhcmNoU3RyKTtcbiAgICAvLyAgIH1cbiAgICAvLyApXG4gICAgLy8gd2F5IElJIFxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgbW92aWVEYXRhQmFzZTogdGhpcy5zdGF0ZS5tb3ZpZURhdGFCYXNlLmNvbmNhdChbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogdGhpcy5zdGF0ZS5hZGRNb3ZpZVN0cixcbiAgICAgICAgICBhZGRlZDogdHJ1ZSxcbiAgICAgICAgICB3YXRjaGVkOiBmYWxzZSxcbiAgICAgICAgICBzaG93OiB0cnVlLFxuICAgICAgICAgIGZpbHRlcjogdHJ1ZSxcbiAgICAgICAgfV0pXG4gICAgfSwgKCkgPT4geyB0aGlzLnNlYXJjaE1vdmllcyh0aGlzLnN0YXRlLnNlYXJjaFN0cik7IH0pO1xuICB9XG5cblxuICB2aWV3V2F0Y2goZSkge1xuICAgIHN3aXRjaCAoZS50YXJnZXQuaWQpIHtcbiAgICAgIGNhc2UgJ3dhdGNoZWQnOlxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1dhdGNoZWQ6IHRydWUsIGFjdGl2YXRlV2F0Y2hlZDogdHJ1ZSB9LCAoKSA9PiB7IHRoaXMudXBkYXRlREIoKSB9KVxuICAgICAgICByZXR1cm47XG4gICAgICBjYXNlICduZXcnOlxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1dhdGNoZWQ6IGZhbHNlLCBhY3RpdmF0ZVdhdGNoZWQ6IHRydWUgfSwgKCkgPT4geyB0aGlzLnVwZGF0ZURCKCkgfSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgY2FzZSAncmVzZXQnOlxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1dhdGNoZWQ6IGZhbHNlLCBhY3RpdmF0ZVdhdGNoZWQ6IGZhbHNlIH0sICgpID0+IHsgdGhpcy51cGRhdGVEQigpIH0pXG4gICAgICAgIHJldHVybjtcblxuXG4gICAgfVxuICAgIC8vIGlmKGUudGFyZ2V0LmlkPT09J3dhdGNoZWQnKXtcbiAgICAvLyB9IGVsc2UgaWYgKGUudGFyZ2V0LmlkPT09J25ldycpe1xuICAgIC8vICAgdGhpcy5zZXRTdGF0ZSh7c2hvd1dhdGNoZWQgOiBmYWxzZSwgYWN0aXZhdGVXYXRjaGVkOnRydWV9LCAoKT0+IHt0aGlzLnVwZGF0ZURCKCl9KTtcbiAgICAvLyB9XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1vdmllLWxpc3RcIj5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nd2F0Y2hUb2dnbGVCdXR0b24nIGlkPSd3YXRjaGVkJyBvbkNsaWNrPXt0aGlzLnZpZXdXYXRjaH0+XG4gICAgICAgICAgICByZXdhdGNoIVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPSd3YXRjaFRvZ2dsZUJ1dHRvbicgaWQ9J25ldycgb25DbGljaz17dGhpcy52aWV3V2F0Y2h9PlxuICAgICAgICAgICAgbmV3IVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPSd3YXRjaFRvZ2dsZUJ1dHRvbicgaWQ9J3Jlc2V0JyBvbkNsaWNrPXt0aGlzLnZpZXdXYXRjaH0+XG4gICAgICAgICAgICByZXNldCB0b2dnbGVcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPE1vdmllcyBjdXJyZW50REI9e3RoaXMuc3RhdGUuY3VycmVudERCfSB3YXRjaGVkVG9nZ2xlPXt0aGlzLndhdGNoZWRUb2dnbGV9IC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8U2VhcmNoIHR5cGVTZWFyY2g9e3RoaXMudHlwZVNlYXJjaH0gc2VhcmNoTW92aWVzPXt0aGlzLnNlYXJjaE1vdmllc30gLz5cbiAgICAgICAgPEFkZCB0eXBlTW92aWU9e3RoaXMudHlwZU1vdmllfSBhZGRNb3ZpZT17dGhpcy5hZGRNb3ZpZX0gLz5cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfVxufTtcblxuTW92aWVMaXN0LnByb3BUeXBlcyA9IHtcbiAgbW92aWVEQjogUmVhY3QuUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWRcbn07XG5leHBvcnQgZGVmYXVsdCBNb3ZpZUxpc3Q7XG53aW5kb3cuTW92aWVMaXN0ID0gTW92aWVMaXN0OyJdfQ==